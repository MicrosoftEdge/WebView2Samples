<!DOCTYPE html>
<html>

<head>
    <title>ScenarioServiceWorkerPostMessage</title>
    <link rel="stylesheet" href="style.css">
    <script>
        "use strict";
        function SendMessageViaMainThread() {
            self.chrome.webview.postMessage("ViaMainThread");
        }

        function SendMessageUsingNewMethod() {
            self.chrome.webview.postMessage("ViaNewMethod");
        }

        self.chrome.webview.addEventListener("message", function (event) {
            if (event.data == "PostMessageToSW") {
                navigator.serviceWorker.controller.postMessage("MainThreadMessage");
            } else if(event.data == 'BlockMainThread'){
                const start = Date.now();
                while (Date.now() - start < 5000) {
                    // Do nothing
                }
                self.chrome.webview.postMessage("MainThreadUnblocked");
            }
        });

        navigator.serviceWorker.addEventListener('message', function (event) {
            if (event.data == "MainThreadMessage") {
                console.log(event.data)
                self.chrome.webview.postMessage(event.data);
            }
        });

        navigator.serviceWorker.register("sw.js");
    </script>
</head>

<body>
    <div>
        <h1>ServiceWorker PostMessage Sample Page</h1>
        <p>This page demonstrates basic interaction between the host app and service workers by
            means of Web Messages.
        </p>
    </div>

    <div>
        <p>Post Message from Service worker to Host process via the main thread</p>
        <button id="oldMethod" onclick="SendMessageViaMainThread()">Send Message via Main Thread</button>
    </div>

    <div>
        <p>Post Message from Service worker to Host process using New Method</p>
        <button id="newMethod" onclick="SendMessageUsingNewMethod()">Send Message via New Method</button>
    </div>
</body>

</html>